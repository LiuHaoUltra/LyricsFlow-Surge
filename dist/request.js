!function(){var e={68:function(e,t,r){"use strict";r.r(t),r.d(t,{parseConfig:function(){return i}});var n=r("514");function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var a={typefUrl:"http://127.0.0.1:8000",enableEnrich:!1,logLevel:n.LogLevel.DEBUG};function i(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n,o,a;n=e,o=t,a=r[t],o in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a})}return e}({},a);if(!e)return t;var r=e.split("&"),i=!0,u=!1,l=void 0;try{for(var c,s=r[Symbol.iterator]();!(i=(c=s.next()).done);i=!0){var f,p,y=(f=c.value.split("="),p=2,function(e){if(Array.isArray(e))return e}(f)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(r=o.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){u=!0,n=e}finally{try{!i&&null!=o.return&&o.return()}finally{if(u)throw n}}return a}}(f,p)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}}(f,p)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),v=y[0],h=y[1];if(v){var b=decodeURIComponent(h||"");switch(v.trim()){case"TYPEF_URL":t.typefUrl=b;break;case"ENABLE_ENRICH":t.enableEnrich="true"===b.toLowerCase();break;case"ENRICH_URL":t.enrichUrl=b;break;case"ENRICH_KEY":t.enrichKey=b;break;case"LogLevel":switch(b.toUpperCase()){case"OFF":t.logLevel=n.LogLevel.OFF;break;case"ERROR":t.logLevel=n.LogLevel.ERROR;break;case"WARN":default:t.logLevel=n.LogLevel.WARN;break;case"INFO":t.logLevel=n.LogLevel.INFO;break;case"DEBUG":t.logLevel=n.LogLevel.DEBUG}}}}}catch(e){u=!0,l=e}finally{try{!i&&null!=s.return&&s.return()}finally{if(u)throw l}}return t}},110:function(e,t,r){"use strict";r.r(t);var n=r("55"),o=r("514"),a=r("68");function i(e,t,r,n,o,a,i){try{var u=e[a](i),l=u.value}catch(e){r(e);return}u.done?t(l):Promise.resolve(l).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function u(e){i(a,n,o,u,l,"next",e)}function l(e){i(a,n,o,u,l,"throw",e)}u(void 0)})}}function l(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function c(){return(c=u(function(){var e,t,r,i,u,c;return l(this,function(l){switch(l.label){case 0:if(e=(0,a.parseConfig)(n.env.args),o.logger.level=e.logLevel,t=n.env.request.url,o.logger.info("[Request] Intercepted: ".concat(t)),!t.includes("/color-lyrics/v2/track/"))return[3,5];l.label=1;case 1:if(l.trys.push([1,4,,5]),i=(r=t.split("/")).indexOf("track"),u="",-1!==i&&r[i+1]&&(u=r[i+1].split("?")[0]),!u)return[3,3];return o.logger.debug("[Request] Track ID: ".concat(u)),[4,function(e){return s.apply(this,arguments)}(u)];case 2:l.sent(),l.label=3;case 3:return[3,5];case 4:return c=l.sent(),o.logger.error("[Request] Error: ".concat(c)),[3,5];case 5:return n.env.done(n.env.request),[2]}})})).apply(this,arguments)}function s(){return(s=u(function(e){var t,r,a,i,u,c,s;return l(this,function(l){switch(l.label){case 0:if(!(r=(t=n.env.request.headers||{}).Authorization||t.authorization))return o.logger.warn("[Request] No Auth Header"),[2];a="https://api.spotify.com/v1/tracks/".concat(e),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,n.env.fetch({url:a,method:"GET",headers:{Authorization:r,Accept:"application/json"}})];case 2:return 200===(i=l.sent()).status&&i.body?(c={trackName:(u="string"==typeof i.body?JSON.parse(i.body):i.body).name,artist:u.artists?u.artists.map(function(e){return e.name}).join(", "):"Unknown",album:u.album?u.album.name:"Unknown",duration:u.duration_ms},n.env.setStorage("".concat("spotify_meta_").concat(e),JSON.stringify(c)),o.logger.info("[Request] Cached metadata: ".concat(c.trackName))):o.logger.warn("[Request] Metadata fetch failed: ".concat(i.status)),[3,4];case 3:return s=l.sent(),o.logger.error("[Request] Fetch Error: ".concat(s)),[3,4];case 4:return[2]}})})).apply(this,arguments)}(function(){return c.apply(this,arguments)})().catch(function(e){o.logger.error("[Request] Global Error: ".concat(e)),n.env.done(n.env.request)})},55:function(e,t,r){"use strict";function n(e,t,r,n,o,a,i){try{var u=e[a](i),l=u.value}catch(e){r(e);return}u.done?t(l):Promise.resolve(l).then(n,o)}r.r(t),r.d(t,{env:function(){return i}});function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=new(function(){var e,t,r;function i(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),a(this,"name",void 0),a(this,"isSurge",void 0),this.name=e,this.isSurge="undefined"!=typeof $httpClient}return e=i,t=[{key:"args",get:function(){return"undefined"!=typeof $argument?$argument:""}},{key:"request",get:function(){return"undefined"!=typeof $request?$request:{url:"",headers:{}}}},{key:"response",get:function(){return"undefined"!=typeof $response?$response:{status:200,headers:{},body:null}}},{key:"fetch",value:function(e){var t,r=this;return(t=function(){var t,n;return function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,function(o){return(t=(e.method||"GET").toUpperCase(),n={url:e.url,method:t,headers:e.headers||{},body:e.body,timeout:e.timeout?e.timeout/1e3:void 0},r.isSurge)?(e.binary,[2,new Promise(function(e,r){$httpClient[t.toLowerCase()](n,function(t,n,o){t?r(t):e({status:n.status||200,headers:n.headers,body:o})})})]):[2,Promise.resolve({error:"Not in Surge environment"})]})},function(){var e=this,r=arguments;return new Promise(function(o,a){var i=t.apply(e,r);function u(e){n(i,o,a,u,l,"next",e)}function l(e){n(i,o,a,u,l,"throw",e)}u(void 0)})})()}},{key:"setStorage",value:function(e,t){this.isSurge&&$persistentStore.write(t,e)}},{key:"getStorage",value:function(e){return this.isSurge?$persistentStore.read(e):null}},{key:"msg",value:function(e,t,r){this.isSurge?$notification.post(e,t,r):console.log("[MSG] ".concat(e," - ").concat(t,": ").concat(r))}},{key:"done",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isSurge&&$done(e)}}],o(e.prototype,t),r&&o(e,r),i}())("LyricsFlow")},514:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}r.r(t),r.d(t,{LogLevel:function(){return l},logger:function(){return c}});function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(u=l||(l={}))[u.OFF=0]="OFF",u[u.ERROR=1]="ERROR",u[u.WARN=2]="WARN",u[u.INFO=3]="INFO",u[u.DEBUG=4]="DEBUG";var u,l,c=new(function(){var e,t,r;function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),a(this,"level",void 0),a(this,"prefix",void 0),this.level="string"==typeof e?this.parseLevel(e):e,this.prefix=t}return e=n,t=[{key:"setLevel",value:function(e){this.level=e}},{key:"parseLevel",value:function(e){switch(e.toUpperCase()){case"OFF":return 0;case"ERROR":return 1;case"WARN":return 2;case"INFO":default:return 3;case"DEBUG":return 4}}},{key:"format",value:function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];var a=new Date().toISOString().split("T")[1].slice(0,-1);return"[".concat(a,"] [").concat(e,"] ").concat(this.prefix).concat(t)}},{key:"error",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];this.level>=1&&(t=console).log.apply(t,[this.format("ERROR",e)].concat(i(n)))}},{key:"warn",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];this.level>=2&&(t=console).log.apply(t,[this.format("WARN",e)].concat(i(n)))}},{key:"info",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];this.level>=3&&(t=console).log.apply(t,[this.format("INFO",e)].concat(i(n)))}},{key:"debug",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];this.level>=4&&(t=console).log.apply(t,[this.format("DEBUG",e)].concat(i(n)))}}],o(e.prototype,t),r&&o(e,r),n}())}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r("110")}();
//# sourceMappingURL=request.js.map