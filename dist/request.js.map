{"version":3,"file":"request.js","sources":["./src/config.ts","./src/request.ts","./src/utils/env.ts","./src/utils/logger.ts"],"sourcesContent":["import { LogLevel } from './utils/logger';\r\n\r\nexport interface Config {\r\n    typefUrl: string;\r\n    enableEnrich: boolean;\r\n    enrichUrl?: string;\r\n    enrichKey?: string;\r\n    logLevel: LogLevel;\r\n}\r\n\r\nconst DEFAULT_CONFIG: Config = {\r\n    typefUrl: 'http://127.0.0.1:8000',\r\n    enableEnrich: false,\r\n    logLevel: LogLevel.DEBUG,  // 默认 DEBUG 方便调试\r\n};\r\n\r\n// BoxJS/persistentStore key prefix\r\nconst STORAGE_PREFIX = '@LyricsFlow.Settings.';\r\n\r\n// Declare $persistentStore for TypeScript\r\ndeclare const $persistentStore: any;\r\n\r\n/**\r\n * 从 persistentStore 读取配置 (BoxJS 兼容)\r\n */\r\nfunction getStorageValue(key: string): string | null {\r\n    if (typeof $persistentStore !== 'undefined') {\r\n        return $persistentStore.read(`${STORAGE_PREFIX}${key}`);\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * 检查值是否是未替换的占位符\r\n */\r\nfunction isPlaceholder(value: string): boolean {\r\n    if (!value) return true;\r\n    // 检查 {XXX} 或 %7BXXX%7D (URL encoded)\r\n    return /^\\{.*\\}$/.test(value) || /%7B.*%7D/i.test(value);\r\n}\r\n\r\n/**\r\n * 解析配置\r\n * 优先级: persistentStore (BoxJS) > $argument > 默认值\r\n */\r\nexport function parseConfig(argsStr: string): Config {\r\n    const config = { ...DEFAULT_CONFIG };\r\n\r\n    // 1. 首先尝试从 persistentStore 读取 (BoxJS)\r\n    const storedUrl = getStorageValue('TYPEF_URL');\r\n    if (storedUrl && !isPlaceholder(storedUrl)) {\r\n        config.typefUrl = storedUrl;\r\n    }\r\n\r\n    const storedEnrich = getStorageValue('ENABLE_ENRICH');\r\n    if (storedEnrich) {\r\n        config.enableEnrich = storedEnrich.toLowerCase() === 'true';\r\n    }\r\n\r\n    const storedEnrichUrl = getStorageValue('ENRICH_URL');\r\n    if (storedEnrichUrl) {\r\n        config.enrichUrl = storedEnrichUrl;\r\n    }\r\n\r\n    const storedEnrichKey = getStorageValue('ENRICH_KEY');\r\n    if (storedEnrichKey) {\r\n        config.enrichKey = storedEnrichKey;\r\n    }\r\n\r\n    const storedLogLevel = getStorageValue('LogLevel');\r\n    if (storedLogLevel) {\r\n        config.logLevel = parseLogLevel(storedLogLevel);\r\n    }\r\n\r\n    // 2. 如果 persistentStore 没有有效的 TYPEF_URL，尝试从 $argument 解析\r\n    if (argsStr && isPlaceholder(config.typefUrl)) {\r\n        const pairs = argsStr.split('&');\r\n        for (const pair of pairs) {\r\n            const [key, value] = pair.split('=');\r\n            if (!key) continue;\r\n            const decodedValue = decodeURIComponent(value || '');\r\n\r\n            // 跳过未替换的占位符\r\n            if (isPlaceholder(decodedValue)) continue;\r\n\r\n            switch (key.trim()) {\r\n                case 'TYPEF_URL':\r\n                    if (!isPlaceholder(decodedValue)) {\r\n                        config.typefUrl = decodedValue;\r\n                    }\r\n                    break;\r\n                case 'ENABLE_ENRICH':\r\n                    config.enableEnrich = decodedValue.toLowerCase() === 'true';\r\n                    break;\r\n                case 'ENRICH_URL':\r\n                    config.enrichUrl = decodedValue;\r\n                    break;\r\n                case 'ENRICH_KEY':\r\n                    config.enrichKey = decodedValue;\r\n                    break;\r\n                case 'LogLevel':\r\n                    config.logLevel = parseLogLevel(decodedValue);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    return config;\r\n}\r\n\r\nfunction parseLogLevel(value: string): LogLevel {\r\n    switch (value.toUpperCase()) {\r\n        case 'OFF': return LogLevel.OFF;\r\n        case 'ERROR': return LogLevel.ERROR;\r\n        case 'WARN': return LogLevel.WARN;\r\n        case 'INFO': return LogLevel.INFO;\r\n        case 'DEBUG': return LogLevel.DEBUG;\r\n        default: return LogLevel.DEBUG;\r\n    }\r\n}\r\n\r\n","import { env } from './utils/env';\r\nimport { logger } from './utils/logger';\r\nimport { parseConfig } from './config';\r\n\r\nconst META_KEY_PREFIX = 'spotify_meta_';\r\n\r\n/**\r\n * Request Script - Following DualSubs Architecture\r\n * 1. Inject subtype=LyricsFlow into URL to trigger response script\r\n * 2. Fetch metadata in parallel (non-blocking)\r\n * 3. Return modified request immediately\r\n */\r\nasync function handleRequest() {\r\n    const config = parseConfig(env.args);\r\n    (logger as any).level = config.logLevel;\r\n\r\n    const url = new URL(env.request.url);\r\n    logger.info(`[Request] Intercepted: ${url.pathname}`);\r\n\r\n    // Only process color-lyrics requests\r\n    if (url.pathname.startsWith('/color-lyrics/v2/track/')) {\r\n        // Extract track ID from path\r\n        const pathParts = url.pathname.split('/');\r\n        const trackId = pathParts[4]; // /color-lyrics/v2/track/{trackId}\r\n\r\n        if (trackId) {\r\n            logger.debug(`[Request] Track ID: ${trackId}`);\r\n\r\n            // 1. Inject subtype param - THIS TRIGGERS THE RESPONSE SCRIPT\r\n            url.searchParams.set('subtype', 'LyricsFlow');\r\n            logger.info(`[Request] Injected subtype=LyricsFlow`);\r\n\r\n            // 2. Fetch metadata in parallel (non-blocking, fire-and-forget)\r\n            fetchMetadataAsync(trackId).catch(e =>\r\n                logger.error(`[Request] Metadata fetch error: ${e}`)\r\n            );\r\n\r\n            // 3. Update request URL with new params\r\n            env.request.url = url.toString();\r\n        }\r\n    }\r\n\r\n    // Always call done() with the (possibly modified) request\r\n    env.done(env.request);\r\n}\r\n\r\n/**\r\n * Async metadata fetch - runs in background, doesn't block request\r\n */\r\nasync function fetchMetadataAsync(trackId: string) {\r\n    const headers = env.request.headers || {};\r\n    const authHeader = headers['Authorization'] || headers['authorization'];\r\n\r\n    if (!authHeader) {\r\n        logger.warn(`[Request] No Auth Header, skipping metadata fetch`);\r\n        return;\r\n    }\r\n\r\n    const metaUrl = `https://api.spotify.com/v1/tracks/${trackId}`;\r\n\r\n    try {\r\n        const response = await env.fetch({\r\n            url: metaUrl,\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': authHeader,\r\n                'Accept': 'application/json'\r\n            }\r\n        });\r\n\r\n        if (response.status === 200 && response.body) {\r\n            const data = typeof response.body === 'string'\r\n                ? JSON.parse(response.body)\r\n                : response.body;\r\n\r\n            const meta = {\r\n                trackName: data.name,\r\n                artist: data.artists ? data.artists.map((a: any) => a.name).join(', ') : 'Unknown',\r\n                album: data.album ? data.album.name : 'Unknown',\r\n                duration: data.duration_ms\r\n            };\r\n\r\n            // Store with track ID as key\r\n            env.setStorage(`${META_KEY_PREFIX}${trackId}`, JSON.stringify(meta));\r\n            logger.info(`[Request] Cached: ${meta.trackName} - ${meta.artist}`);\r\n        } else {\r\n            logger.warn(`[Request] Metadata fetch returned ${response.status}`);\r\n        }\r\n    } catch (err) {\r\n        logger.error(`[Request] Fetch error: ${err}`);\r\n    }\r\n}\r\n\r\n// Execute\r\nhandleRequest().catch(err => {\r\n    logger.error(`[Request] Global Error: ${err}`);\r\n    env.done(env.request);\r\n});","/**\r\n * Environment Adapter for Surge\r\n * Handles HTTP requests, persistence, and script completion.\r\n */\r\n\r\nexport interface HelperRequestOpts {\r\n    url: string;\r\n    method?: string; // GET, POST, etc.\r\n    headers?: Record<string, string>;\r\n    body?: string | Uint8Array;\r\n    timeout?: number;\r\n    binary?: boolean; // If true, response body is expected to be binary (Uint8Array/Buffer)\r\n}\r\n\r\nexport class Env {\r\n    private name: string;\r\n    private isSurge: boolean;\r\n\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.isSurge = typeof $httpClient !== 'undefined';\r\n    }\r\n\r\n    get args(): string {\r\n        return typeof $argument !== 'undefined' ? $argument : '';\r\n    }\r\n\r\n    get request(): any {\r\n        return typeof $request !== 'undefined' ? $request : { url: '', headers: {} };\r\n    }\r\n\r\n    get response(): any {\r\n        return typeof $response !== 'undefined' ? $response : { status: 200, headers: {}, body: null };\r\n    }\r\n\r\n    /**\r\n     * Sends an HTTP request.\r\n     */\r\n    async fetch(opts: HelperRequestOpts): Promise<any> {\r\n        // Normalize method\r\n        const method = (opts.method || 'GET').toUpperCase();\r\n\r\n        // Prepare options for Surge\r\n        const requestOptions: any = {\r\n            url: opts.url,\r\n            method: method,\r\n            headers: opts.headers || {},\r\n            body: opts.body,\r\n            timeout: opts.timeout ? opts.timeout / 1000 : undefined, // Surge timeout is in seconds? usually defaults. \r\n        };\r\n\r\n        if (this.isSurge) {\r\n            if (opts.binary) {\r\n                // In Surge, for binary response, usually no special flag in request opts \r\n                // but $httpClient callback receives 'data' which can be binary if headers say so?\r\n                // Actually, $httpClient usually returns string or object. \r\n                // For binary, we might need to check how Surge handles it. \r\n                // usually it's automatic or we rely on 'node-buffer' polyfill if bundled.\r\n                // But for response, Surge passes `data`.\r\n            }\r\n\r\n            return new Promise((resolve, reject) => {\r\n                $httpClient[method.toLowerCase()](requestOptions, (error: any, response: any, data: any) => {\r\n                    if (error) {\r\n                        reject(error);\r\n                    } else {\r\n                        resolve({\r\n                            status: response.status || 200,\r\n                            headers: response.headers,\r\n                            body: data, // string or object or whatever Surge returns\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n        } else {\r\n            // Fallback for Node/Testing (using global fetch if available)\r\n            return Promise.resolve({ error: \"Not in Surge environment\" });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Writes to persistent storage.\r\n     */\r\n    setStorage(key: string, value: string): void {\r\n        if (this.isSurge) {\r\n            $persistentStore.write(value, key);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reads from persistent storage.\r\n     */\r\n    getStorage(key: string): string | null {\r\n        if (this.isSurge) {\r\n            return $persistentStore.read(key);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Sends a system notification.\r\n     */\r\n    msg(title: string, subtitle: string, body: string): void {\r\n        if (this.isSurge) {\r\n            $notification.post(title, subtitle, body);\r\n        } else {\r\n            console.log(`[MSG] ${title} - ${subtitle}: ${body}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Completes the script execution.\r\n     */\r\n    done(value: any = {}): void {\r\n        if (this.isSurge) {\r\n            $done(value);\r\n        }\r\n    }\r\n}\r\n\r\n// Global types for Surge (to avoid TS errors)\r\ndeclare const $httpClient: any;\r\ndeclare const $persistentStore: any;\r\ndeclare const $notification: any;\r\ndeclare const $done: any;\r\ndeclare const $argument: string | undefined;\r\ndeclare const $request: any;\r\ndeclare const $response: any;\r\n\r\nexport const env = new Env('LyricsFlow');\r\n","export enum LogLevel {\r\n    OFF = 0,\r\n    ERROR = 1,\r\n    WARN = 2,\r\n    INFO = 3,\r\n    DEBUG = 4,\r\n}\r\n\r\nexport class Logger {\r\n    private level: LogLevel;\r\n    private prefix: string;\r\n\r\n    constructor(level: string | LogLevel = LogLevel.INFO, prefix: string = '') {\r\n        this.level = typeof level === 'string' ? this.parseLevel(level) : level;\r\n        this.prefix = prefix;\r\n    }\r\n\r\n    public setLevel(level: LogLevel) {\r\n        this.level = level;\r\n    }\r\n\r\n    private parseLevel(level: string): LogLevel {\r\n        switch (level.toUpperCase()) {\r\n            case 'OFF': return LogLevel.OFF;\r\n            case 'ERROR': return LogLevel.ERROR;\r\n            case 'WARN': return LogLevel.WARN;\r\n            case 'INFO': return LogLevel.INFO;\r\n            case 'DEBUG': return LogLevel.DEBUG;\r\n            default: return LogLevel.INFO;\r\n        }\r\n    }\r\n\r\n    private format(level: string, message: string, ...args: any[]): string {\r\n        const timestamp = new Date().toISOString().split('T')[1].slice(0, -1);\r\n        return `[${timestamp}] [${level}] ${this.prefix}${message}`;\r\n    }\r\n\r\n    error(message: string, ...args: any[]): void {\r\n        if (this.level >= LogLevel.ERROR) {\r\n            console.log(this.format('ERROR', message), ...args);\r\n        }\r\n    }\r\n\r\n    warn(message: string, ...args: any[]): void {\r\n        if (this.level >= LogLevel.WARN) {\r\n            console.log(this.format('WARN', message), ...args);\r\n        }\r\n    }\r\n\r\n    info(message: string, ...args: any[]): void {\r\n        if (this.level >= LogLevel.INFO) {\r\n            console.log(this.format('INFO', message), ...args);\r\n        }\r\n    }\r\n\r\n    debug(message: string, ...args: any[]): void {\r\n        if (this.level >= LogLevel.DEBUG) {\r\n            console.log(this.format('DEBUG', message), ...args);\r\n        }\r\n    }\r\n}\r\n\r\nexport const logger = new Logger(); // Default instance\r\n"],"names":["DEFAULT_CONFIG","typefUrl","enableEnrich","logLevel","LogLevel","getStorageValue","key","$persistentStore","read","isPlaceholder","value","test","parseConfig","argsStr","config","storedUrl","storedEnrich","toLowerCase","storedEnrichUrl","enrichUrl","storedEnrichKey","enrichKey","storedLogLevel","parseLogLevel","pairs","split","pair","decodedValue","decodeURIComponent","trim","toUpperCase","url","trackId","env","logger","URL","pathname","startsWith","pathParts","searchParams","set","fetchMetadataAsync","catch","e","toString","headers","authHeader","metaUrl","response","data","meta","err","method","status","body","trackName","JSON","parse","name","artist","artists","map","a","join","album","duration","duration_ms","stringify","handleRequest","Env","isSurge","$httpClient","$argument","$request","$response","opts","requestOptions","timeout","undefined","binary","Promise","resolve","reject","error","write","title","subtitle","$notification","post","console","log","$done","Logger","level","prefix","parseLevel","message","args","timestamp","Date","toISOString","slice","format"],"mappings":"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"}