{"version":3,"file":"request.js","sources":["./src/config.ts","./src/request.ts","./src/utils/env.ts","./src/utils/logger.ts"],"sourcesContent":["import { LogLevel } from './utils/logger';\r\n\r\nexport interface Config {\r\n    typefUrl: string;\r\n    enableEnrich: boolean;\r\n    enrichUrl?: string;\r\n    enrichKey?: string;\r\n    logLevel: LogLevel;\r\n}\r\n\r\nconst DEFAULT_CONFIG: Config = {\r\n    typefUrl: 'http://127.0.0.1:8000',\r\n    enableEnrich: false,\r\n    logLevel: LogLevel.DEBUG,  // 默认 DEBUG 方便调试\r\n};\r\n\r\n// BoxJS/persistentStore key prefix\r\nconst STORAGE_PREFIX = '@LyricsFlow.Settings.';\r\n\r\n// Declare $persistentStore for TypeScript\r\ndeclare const $persistentStore: any;\r\n\r\n/**\r\n * 从 persistentStore 读取配置 (BoxJS 兼容)\r\n */\r\nfunction getStorageValue(key: string): string | null {\r\n    if (typeof $persistentStore !== 'undefined') {\r\n        return $persistentStore.read(`${STORAGE_PREFIX}${key}`);\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * 检查值是否是未替换的占位符\r\n */\r\nfunction isPlaceholder(value: string): boolean {\r\n    if (!value) return true;\r\n    // 检查 {XXX} 或 %7BXXX%7D (URL encoded)\r\n    return /^\\{.*\\}$/.test(value) || /%7B.*%7D/i.test(value);\r\n}\r\n\r\n/**\r\n * 解析配置\r\n * 优先级: persistentStore (BoxJS) > $argument > 默认值\r\n */\r\nexport function parseConfig(argsStr: string): Config {\r\n    const config = { ...DEFAULT_CONFIG };\r\n\r\n    // 1. 首先尝试从 persistentStore 读取 (BoxJS)\r\n    const storedUrl = getStorageValue('TYPEF_URL');\r\n    if (storedUrl && !isPlaceholder(storedUrl)) {\r\n        config.typefUrl = storedUrl;\r\n    }\r\n\r\n    const storedEnrich = getStorageValue('ENABLE_ENRICH');\r\n    if (storedEnrich) {\r\n        config.enableEnrich = storedEnrich.toLowerCase() === 'true';\r\n    }\r\n\r\n    const storedEnrichUrl = getStorageValue('ENRICH_URL');\r\n    if (storedEnrichUrl) {\r\n        config.enrichUrl = storedEnrichUrl;\r\n    }\r\n\r\n    const storedEnrichKey = getStorageValue('ENRICH_KEY');\r\n    if (storedEnrichKey) {\r\n        config.enrichKey = storedEnrichKey;\r\n    }\r\n\r\n    const storedLogLevel = getStorageValue('LogLevel');\r\n    if (storedLogLevel) {\r\n        config.logLevel = parseLogLevel(storedLogLevel);\r\n    }\r\n\r\n    // 2. 如果 persistentStore 没有有效的 TYPEF_URL，尝试从 $argument 解析\r\n    if (argsStr && isPlaceholder(config.typefUrl)) {\r\n        const pairs = argsStr.split('&');\r\n        for (const pair of pairs) {\r\n            const [key, value] = pair.split('=');\r\n            if (!key) continue;\r\n            const decodedValue = decodeURIComponent(value || '');\r\n\r\n            // 跳过未替换的占位符\r\n            if (isPlaceholder(decodedValue)) continue;\r\n\r\n            switch (key.trim()) {\r\n                case 'TYPEF_URL':\r\n                    if (!isPlaceholder(decodedValue)) {\r\n                        config.typefUrl = decodedValue;\r\n                    }\r\n                    break;\r\n                case 'ENABLE_ENRICH':\r\n                    config.enableEnrich = decodedValue.toLowerCase() === 'true';\r\n                    break;\r\n                case 'ENRICH_URL':\r\n                    config.enrichUrl = decodedValue;\r\n                    break;\r\n                case 'ENRICH_KEY':\r\n                    config.enrichKey = decodedValue;\r\n                    break;\r\n                case 'LogLevel':\r\n                    config.logLevel = parseLogLevel(decodedValue);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    return config;\r\n}\r\n\r\nfunction parseLogLevel(value: string): LogLevel {\r\n    switch (value.toUpperCase()) {\r\n        case 'OFF': return LogLevel.OFF;\r\n        case 'ERROR': return LogLevel.ERROR;\r\n        case 'WARN': return LogLevel.WARN;\r\n        case 'INFO': return LogLevel.INFO;\r\n        case 'DEBUG': return LogLevel.DEBUG;\r\n        default: return LogLevel.DEBUG;\r\n    }\r\n}\r\n\r\n","import { env } from './utils/env';\r\nimport { logger } from './utils/logger';\r\nimport { parseConfig } from './config';\r\n\r\nconst META_KEY_PREFIX = 'spotify_meta_';\r\n\r\nasync function handleRequest() {\r\n    // 初始化配置和日志级别\r\n    const config = parseConfig(env.args);\r\n    (logger as any).level = config.logLevel;\r\n\r\n    const url = env.request.url;\r\n    logger.info(`[Request] Intercepted: ${url}`);\r\n\r\n    // 确保只处理歌词接口\r\n    if (url.includes('/color-lyrics/v2/track/')) {\r\n        try {\r\n            const parts = url.split('/');\r\n            const trackIndex = parts.indexOf('track');\r\n            let trackId = '';\r\n            // 提取 Track ID\r\n            if (trackIndex !== -1 && parts[trackIndex + 1]) {\r\n                trackId = parts[trackIndex + 1].split('?')[0];\r\n            }\r\n\r\n            if (trackId) {\r\n                logger.debug(`[Request] Track ID: ${trackId}`);\r\n                await fetchAndCacheMetadata(trackId);\r\n            }\r\n        } catch (err) {\r\n            logger.error(`[Request] Error: ${err}`);\r\n        }\r\n    }\r\n    // 关键修复：返回原始 $request 对象，让请求继续\r\n    env.done(env.request);\r\n}\r\n\r\nasync function fetchAndCacheMetadata(trackId: string) {\r\n    const headers = env.request.headers || {};\r\n    // 关键：复用当前请求的 Authorization 头\r\n    const authHeader = headers['Authorization'] || headers['authorization'];\r\n\r\n    if (!authHeader) {\r\n        logger.warn(`[Request] No Auth Header`);\r\n        return;\r\n    }\r\n\r\n    // 修正：直接请求 Spotify 官方 Web API (返回 JSON)\r\n    const metaUrl = `https://api.spotify.com/v1/tracks/${trackId}`;\r\n\r\n    try {\r\n        const response = await env.fetch({\r\n            url: metaUrl,\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': authHeader,\r\n                'Accept': 'application/json'\r\n            }\r\n        });\r\n\r\n        if (response.status === 200 && response.body) {\r\n            const data = typeof response.body === 'string' ? JSON.parse(response.body) : response.body;\r\n\r\n            // 提取需要的元数据\r\n            const meta = {\r\n                trackName: data.name,\r\n                artist: data.artists ? data.artists.map((a: any) => a.name).join(', ') : 'Unknown',\r\n                album: data.album ? data.album.name : 'Unknown',\r\n                duration: data.duration_ms\r\n            };\r\n\r\n            // 写入持久化缓存\r\n            env.setStorage(`${META_KEY_PREFIX}${trackId}`, JSON.stringify(meta));\r\n            logger.info(`[Request] Cached metadata: ${meta.trackName}`);\r\n        } else {\r\n            logger.warn(`[Request] Metadata fetch failed: ${response.status}`);\r\n        }\r\n    } catch (err) {\r\n        logger.error(`[Request] Fetch Error: ${err}`);\r\n    }\r\n}\r\n\r\nhandleRequest().catch(err => {\r\n    logger.error(`[Request] Global Error: ${err}`);\r\n    env.done(env.request);\r\n});","/**\r\n * Environment Adapter for Surge\r\n * Handles HTTP requests, persistence, and script completion.\r\n */\r\n\r\nexport interface HelperRequestOpts {\r\n    url: string;\r\n    method?: string; // GET, POST, etc.\r\n    headers?: Record<string, string>;\r\n    body?: string | Uint8Array;\r\n    timeout?: number;\r\n    binary?: boolean; // If true, response body is expected to be binary (Uint8Array/Buffer)\r\n}\r\n\r\nexport class Env {\r\n    private name: string;\r\n    private isSurge: boolean;\r\n\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.isSurge = typeof $httpClient !== 'undefined';\r\n    }\r\n\r\n    get args(): string {\r\n        return typeof $argument !== 'undefined' ? $argument : '';\r\n    }\r\n\r\n    get request(): any {\r\n        return typeof $request !== 'undefined' ? $request : { url: '', headers: {} };\r\n    }\r\n\r\n    get response(): any {\r\n        return typeof $response !== 'undefined' ? $response : { status: 200, headers: {}, body: null };\r\n    }\r\n\r\n    /**\r\n     * Sends an HTTP request.\r\n     */\r\n    async fetch(opts: HelperRequestOpts): Promise<any> {\r\n        // Normalize method\r\n        const method = (opts.method || 'GET').toUpperCase();\r\n\r\n        // Prepare options for Surge\r\n        const requestOptions: any = {\r\n            url: opts.url,\r\n            method: method,\r\n            headers: opts.headers || {},\r\n            body: opts.body,\r\n            timeout: opts.timeout ? opts.timeout / 1000 : undefined, // Surge timeout is in seconds? usually defaults. \r\n        };\r\n\r\n        if (this.isSurge) {\r\n            if (opts.binary) {\r\n                // In Surge, for binary response, usually no special flag in request opts \r\n                // but $httpClient callback receives 'data' which can be binary if headers say so?\r\n                // Actually, $httpClient usually returns string or object. \r\n                // For binary, we might need to check how Surge handles it. \r\n                // usually it's automatic or we rely on 'node-buffer' polyfill if bundled.\r\n                // But for response, Surge passes `data`.\r\n            }\r\n\r\n            return new Promise((resolve, reject) => {\r\n                $httpClient[method.toLowerCase()](requestOptions, (error: any, response: any, data: any) => {\r\n                    if (error) {\r\n                        reject(error);\r\n                    } else {\r\n                        resolve({\r\n                            status: response.status || 200,\r\n                            headers: response.headers,\r\n                            body: data, // string or object or whatever Surge returns\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n        } else {\r\n            // Fallback for Node/Testing (using global fetch if available)\r\n            return Promise.resolve({ error: \"Not in Surge environment\" });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Writes to persistent storage.\r\n     */\r\n    setStorage(key: string, value: string): void {\r\n        if (this.isSurge) {\r\n            $persistentStore.write(value, key);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reads from persistent storage.\r\n     */\r\n    getStorage(key: string): string | null {\r\n        if (this.isSurge) {\r\n            return $persistentStore.read(key);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Sends a system notification.\r\n     */\r\n    msg(title: string, subtitle: string, body: string): void {\r\n        if (this.isSurge) {\r\n            $notification.post(title, subtitle, body);\r\n        } else {\r\n            console.log(`[MSG] ${title} - ${subtitle}: ${body}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Completes the script execution.\r\n     */\r\n    done(value: any = {}): void {\r\n        if (this.isSurge) {\r\n            $done(value);\r\n        }\r\n    }\r\n}\r\n\r\n// Global types for Surge (to avoid TS errors)\r\ndeclare const $httpClient: any;\r\ndeclare const $persistentStore: any;\r\ndeclare const $notification: any;\r\ndeclare const $done: any;\r\ndeclare const $argument: string | undefined;\r\ndeclare const $request: any;\r\ndeclare const $response: any;\r\n\r\nexport const env = new Env('LyricsFlow');\r\n","export enum LogLevel {\r\n    OFF = 0,\r\n    ERROR = 1,\r\n    WARN = 2,\r\n    INFO = 3,\r\n    DEBUG = 4,\r\n}\r\n\r\nexport class Logger {\r\n    private level: LogLevel;\r\n    private prefix: string;\r\n\r\n    constructor(level: string | LogLevel = LogLevel.INFO, prefix: string = '') {\r\n        this.level = typeof level === 'string' ? this.parseLevel(level) : level;\r\n        this.prefix = prefix;\r\n    }\r\n\r\n    public setLevel(level: LogLevel) {\r\n        this.level = level;\r\n    }\r\n\r\n    private parseLevel(level: string): LogLevel {\r\n        switch (level.toUpperCase()) {\r\n            case 'OFF': return LogLevel.OFF;\r\n            case 'ERROR': return LogLevel.ERROR;\r\n            case 'WARN': return LogLevel.WARN;\r\n            case 'INFO': return LogLevel.INFO;\r\n            case 'DEBUG': return LogLevel.DEBUG;\r\n            default: return LogLevel.INFO;\r\n        }\r\n    }\r\n\r\n    private format(level: string, message: string, ...args: any[]): string {\r\n        const timestamp = new Date().toISOString().split('T')[1].slice(0, -1);\r\n        return `[${timestamp}] [${level}] ${this.prefix}${message}`;\r\n    }\r\n\r\n    error(message: string, ...args: any[]): void {\r\n        if (this.level >= LogLevel.ERROR) {\r\n            console.log(this.format('ERROR', message), ...args);\r\n        }\r\n    }\r\n\r\n    warn(message: string, ...args: any[]): void {\r\n        if (this.level >= LogLevel.WARN) {\r\n            console.log(this.format('WARN', message), ...args);\r\n        }\r\n    }\r\n\r\n    info(message: string, ...args: any[]): void {\r\n        if (this.level >= LogLevel.INFO) {\r\n            console.log(this.format('INFO', message), ...args);\r\n        }\r\n    }\r\n\r\n    debug(message: string, ...args: any[]): void {\r\n        if (this.level >= LogLevel.DEBUG) {\r\n            console.log(this.format('DEBUG', message), ...args);\r\n        }\r\n    }\r\n}\r\n\r\nexport const logger = new Logger(); // Default instance\r\n"],"names":["DEFAULT_CONFIG","typefUrl","enableEnrich","logLevel","LogLevel","getStorageValue","key","$persistentStore","read","isPlaceholder","value","test","parseConfig","argsStr","config","storedUrl","storedEnrich","toLowerCase","storedEnrichUrl","enrichUrl","storedEnrichKey","enrichKey","storedLogLevel","parseLogLevel","pairs","split","pair","decodedValue","decodeURIComponent","trim","toUpperCase","url","parts","trackIndex","trackId","err","env","logger","includes","indexOf","fetchAndCacheMetadata","headers","authHeader","metaUrl","response","data","meta","method","status","body","trackName","JSON","parse","name","artist","artists","map","a","join","album","duration","duration_ms","stringify","handleRequest","catch","Env","isSurge","$httpClient","$argument","$request","$response","opts","requestOptions","timeout","undefined","binary","Promise","resolve","reject","error","write","title","subtitle","$notification","post","console","log","$done","Logger","level","prefix","parseLevel","message","args","timestamp","Date","toISOString","slice","format"],"mappings":"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"}